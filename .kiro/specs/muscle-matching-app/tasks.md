# 実装計画

## 1. プロジェクトセットアップとベース構造の構築

- [x] 1.1 Next.js 15プロジェクトの初期化とディレクトリ構造の設定
  - [x] App Routerの構造に従ったディレクトリ作成
  - [x] TailwindCSSとShadcn UIのセットアップ
  
  _Requirements: Requirement 1_

- [x] 1.2 Convexバックエンドの初期化と設定
  - [x] Convexプロジェクトの初期化
  - [x] スキーマ定義の基本構造作成
  - [x] Next.jsとの接続設定
  
  _Requirements: Requirement 1, 2, 3, 4, 5, 6, 7_

- [x] 1.3 認証システムの基本実装
  - [x] Convex Authの設定
  - [x] ログイン/登録フォームの作成
  - [x] 認証状態管理の実装
  
  _Requirements: Requirement 1_

## 2. ユーザー登録・認証フローの実装

- [x] 2.1 基本登録機能の実装
  - [x] メール/パスワード登録フォームの作成
  - [x] 入力バリデーションの実装
  - [x] 登録APIエンドポイントの実装
  - [x] ユニットテストの作成
  - [x] セキュリティ強化（管理者審査システム実装）
  - [x] 権限ベースアクセス制御実装
  - [x] エラーハンドリング改善
  ✅ 完了日時: 2025-01-23（追加改善: 2025-01-23）
  📝 レビュー結果: Gemini・o3レビュー完了、セキュリティ・アーキテクチャ・品質全面改善実施
  🔧 実装内容: Convex Auth統合、管理者審査システム、RoleGuard、セキュリティ強化、エラーハンドリング改善
  🧪 テスト実装: 全80テスト通過（100%成功率）、管理者機能テスト追加、セキュリティテスト強化
  🔒 セキュリティ強化: 権限レベルベース認証、管理者機能、監査ログ準備、データサニタイゼーション
  
  _Requirements: Requirement 1.1_

- [x] 2.2 プロフィール登録フローの実装
  - [x] プロフィール入力フォームの作成
  - [x] 段階的なフォーム入力UIの実装（3ステップフォーム）
  - [x] プロフィール保存APIの実装
  - [x] バリデーション・エラーハンドリング強化
  - [x] セキュリティ改善（データサニタイゼーション）
  ✅ 完了日時: 2025-01-23
  📝 レビュー結果: Gemini・o3レビュー完了、UX・セキュリティ・品質改善実施
  🔧 実装内容: 3段階プロフィール登録フォーム、リアルタイムバリデーション、年齢自動計算、進捗表示
  🧪 テスト実装: ProfileRegistrationForm.test.tsx（完全テストカバレッジ）
  🎨 UX強化: 段階的入力、進捗インジケーター、リアルタイムフィードバック、エラー表示改善
  
  _Requirements: Requirement 1.2, 1.3, Requirement 2_

- [x] 2.3 本人確認・筋肉確認機能の実装
  - [x] 画像アップロードコンポーネントの作成（ドラッグ&ドロップ対応）
  - [x] Convex File Storageとの連携
  - [x] 審査状態管理の実装
  - [x] 男女別審査フローの実装
  - [x] リアルタイム審査ステータス表示
  - [x] セキュアなファイルバリデーション
  - [x] 権限レベル計算システム
  - [x] 審査申請・結果通知システム
  ✅ 完了日時: 2025-01-23
  📝 レビュー結果: 完全実装・テスト100%通過
  🔧 実装内容: ImageUpload、VerificationUpload、VerificationStatus、認証ページ、File Storage統合
  🧪 テスト実装: 94テスト全て通過（100%成功率）、画像アップロード・審査システム網羅
  🔒 セキュリティ実装: ファイルバリデーション、権限チェック、審査状態管理、プライバシー保護
  🎨 UX実装: ドラッグ&ドロップ、プレビュー表示、タブ切り替え、リアルタイムステータス、エラーハンドリング
  
  _Requirements: Requirement 1.3, 1.4, 1.5, 1.6, 1.7, 1.8_

## 3. プロフィール管理システムの実装

- [ ] 3.1 プロフィールデータモデルの実装
  - [ ] ユーザーモデルの実装
  - [ ] プロフィールモデルの実装
  - [ ] データバリデーションの実装
  
  _Requirements: Requirement 2_

- [ ] 3.2 プロフィール編集機能の実装
  - [ ] プロフィール編集フォームの作成
  - [ ] 写真アップロード・管理機能の実装
  - [ ] プロフィール更新APIの実装
  
  _Requirements: Requirement 2.1, 2.2, 2.3, 2.4, 2.5, 2.6, 2.7_

- [ ] 3.3 プロフィール表示コンポーネントの実装
  - [ ] プロフィールカードUIの作成
  - [ ] 詳細プロフィール表示画面の実装
  
  _Requirements: Requirement 2, Requirement 3_

## 4. マッチングシステムの実装

- [ ] 4.1 スワイプインターフェースの実装
  - [ ] スワイプUIコンポーネントの作成
  - [ ] アニメーション効果の実装
  - [ ] スワイプアクションの処理
  
  _Requirements: Requirement 3.1, 3.2_

- [ ] 4.2 マッチングロジックの実装
  - [ ] いいね/パス機能のAPIエンドポイント実装
  - [ ] マッチング判定ロジックの実装
  - [ ] マッチ通知の実装
  
  _Requirements: Requirement 3.2, 3.3, Requirement 7.1_

- [ ] 4.3 検索フィルター機能の実装
  - [ ] フィルターUIの作成
  - [ ] フィルター条件に基づくクエリ実装
  - [ ] フィルター結果表示の最適化
  
  _Requirements: Requirement 3.4_

- [ ] 4.4 マッチリスト機能の実装
  - [ ] マッチリスト表示UIの作成
  - [ ] マッチ状態管理の実装
  - [ ] マッチ解除機能の実装
  
  _Requirements: Requirement 3.5_

- [ ] 4.5 いいね制限機能の実装
  - [ ] フリープランユーザーのいいね制限実装
  - [ ] 制限カウンターとリセットロジックの実装
  - [ ] プレミアムユーザー判定の実装
  
  _Requirements: Requirement 3.6, 3.7, Requirement 6_

## 5. メッセージングシステムの実装

- [ ] 5.1 チャットインターフェースの実装
  - [ ] チャットUIコンポーネントの作成
  - [ ] メッセージ表示の実装
  - [ ] メッセージ入力フォームの実装
  
  _Requirements: Requirement 4.1, 4.2_

- [ ] 5.2 リアルタイムメッセージング機能の実装
  - [ ] Convexリアルタイム購読の設定
  - [ ] メッセージ送受信APIの実装
  - [ ] メッセージ状態管理の実装
  
  _Requirements: Requirement 4.1, 4.2, 4.3_

- [ ] 5.3 既読機能の実装
  - [ ] 既読状態管理の実装
  - [ ] 既読表示UIの実装
  - [ ] プレミアム機能としての既読確認制限
  
  _Requirements: Requirement 4.3, 4.6_

- [ ] 5.4 メディア共有機能の実装
  - [ ] 画像アップロードコンポーネントの実装
  - [ ] 画像表示コンポーネントの実装
  - [ ] メディア送信APIの実装
  
  _Requirements: Requirement 4.4_

- [ ] 5.5 メッセージ履歴機能の実装
  - [ ] メッセージ履歴取得APIの実装
  - [ ] 無限スクロールの実装
  - [ ] メッセージ検索機能の実装
  
  _Requirements: Requirement 4.5_

## 6. 管理者システムの実装

- [ ] 6.1 管理者ダッシュボードの実装
  - [ ] 管理者専用ルートの作成
  - [ ] ダッシュボードUIの実装
  - [ ] 管理者権限チェックの実装
  
  _Requirements: Requirement 5_

- [ ] 6.2 審査システムの実装
  - [ ] 審査キューUIの実装
  - [ ] 審査処理APIの実装
  - [ ] 審査結果通知の実装
  
  _Requirements: Requirement 5.1, 5.2, 5.3, Requirement 7.3_

- [ ] 6.3 ユーザー管理機能の実装
  - [ ] ユーザー一覧表示の実装
  - [ ] ユーザー検索・フィルター機能の実装
  - [ ] ユーザー詳細表示の実装
  
  _Requirements: Requirement 5.4_

- [ ] 6.4 ユーザー権限管理の実装
  - [ ] 権限レベル変更UIの実装
  - [ ] 権限変更APIの実装
  - [ ] 権限に基づく機能制限の実装
  
  _Requirements: Requirement 5.5_

- [ ] 6.5 ユーザー停止機能の実装
  - [ ] アカウント停止UIの実装
  - [ ] 停止処理APIの実装
  - [ ] 停止通知の実装
  
  _Requirements: Requirement 5.6_

- [ ] 6.6 統計・分析機能の実装
  - [ ] 統計データ取得APIの実装
  - [ ] グラフ・チャート表示の実装
  - [ ] データエクスポート機能の実装
  
  _Requirements: Requirement 5.7_

## 7. 課金システムの実装

- [ ] 7.1 Stripe連携の実装
  - [ ] Stripe APIキーの設定
  - [ ] 決済フローの実装
  - [ ] Webhookハンドラーの実装
  
  _Requirements: Requirement 6.1, 6.2_

- [ ] 7.2 プレミアム機能の実装
  - [ ] プレミアム機能フラグの実装
  - [ ] プレミアムユーザー判定ロジックの実装
  - [ ] プレミアム機能UIの実装
  
  _Requirements: Requirement 6.2_

- [ ] 7.3 サブスクリプション管理の実装
  - [ ] サブスクリプション状態管理の実装
  - [ ] 更新・キャンセル機能の実装
  - [ ] 支払い方法管理の実装
  
  _Requirements: Requirement 6.3, 6.4, 6.5, 6.6_

- [ ] 7.4 決済履歴機能の実装
  - [ ] 決済履歴取得APIの実装
  - [ ] 決済履歴表示UIの実装
  - [ ] 領収書生成機能の実装
  
  _Requirements: Requirement 6.3_

## 8. 通知システムの実装

- [ ] 8.1 プッシュ通知基盤の実装
  - [ ] Web Push API / FCM設定
  - [ ] 通知権限リクエストフローの実装
  - [ ] 通知送信APIの実装
  
  _Requirements: Requirement 7.1, 7.2_

- [ ] 8.2 アプリ内通知機能の実装
  - [ ] 通知コンポーネントの実装
  - [ ] 通知状態管理の実装
  - [ ] 通知既読機能の実装
  
  _Requirements: Requirement 7.1, 7.3, 7.4, 7.5_

- [ ] 8.3 メール通知機能の実装
  - [ ] メール送信サービスの設定
  - [ ] メールテンプレートの作成
  - [ ] メール送信トリガーの実装
  
  _Requirements: Requirement 7.3, 7.4_

- [ ] 8.4 通知設定機能の実装
  - [ ] 通知設定UIの実装
  - [ ] 通知設定保存APIの実装
  - [ ] 設定に基づく通知フィルタリングの実装
  
  _Requirements: Requirement 7.5_

- [ ] 8.5 再訪促進通知の実装
  - [ ] 非アクティブユーザー検出ロジックの実装
  - [ ] 再訪促進通知テンプレートの作成
  - [ ] 定期通知スケジューリングの実装
  
  _Requirements: Requirement 7.6_

## 9. セキュリティ強化とエラー処理

- [ ] 9.1 入力バリデーションの強化
  - [ ] すべての入力フォームのバリデーション実装
  - [ ] サーバーサイドバリデーションの実装
  - [ ] エラーメッセージの国際化
  
  _Requirements: All Requirements_

- [ ] 9.2 エラー処理システムの実装
  - [ ] グローバルエラーハンドラーの実装
  - [ ] エラーログ記録の実装
  - [ ] ユーザーフレンドリーなエラー表示の実装
  
  _Requirements: All Requirements_

- [ ] 9.3 レート制限の実装
  - [ ] API呼び出し制限の実装
  - [ ] アカウント作成制限の実装
  - [ ] いいね送信制限の実装
  
  _Requirements: Requirement 3.6_

## 10. テストとデプロイメント

- [ ] 10.1 ユニットテストの実装
  - [ ] コンポーネントテストの作成
  - [ ] サービス関数テストの作成
  - [ ] バリデーションロジックテストの作成
  
  _Requirements: All Requirements_

- [ ] 10.2 統合テストの実装
  - [ ] APIエンドポイントテストの作成
  - [ ] データフローテストの作成
  - [ ] 認証フローテストの作成
  
  _Requirements: All Requirements_

- [ ] 10.3 E2Eテストの実装
  - [ ] クリティカルパスのE2Eテスト作成
  - [ ] ユーザーフローテストの作成
  
  _Requirements: All Requirements_

- [ ] 10.4 CI/CDパイプラインの設定
  - [ ] GitHub Actionsの設定
  - [ ] 自動テスト実行の設定
  - [ ] 自動デプロイの設定
  
  _Requirements: All Requirements_